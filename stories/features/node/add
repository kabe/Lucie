Story: Add a node with 'node' command
  As a cluster administrator
  I want to add a node using 'node' command
  So that I can add a node to the system

  Scenario: node add success (lucied is UP, installer is added)
    Given nodes directory is '/tmp/nodes'
    And lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add 'TEST_NODE' node
    Then we get no error
    And MAC address file should be created at /tmp/nodes/TEST_NODE/00_00_00_00_00_00
    And installer file should be created at /tmp/nodes/TEST_NODE/TEST_INSTALLER
    And the MAC address file should include gateway definition
    And the MAC address file should include ip_address definition
    And the MAC address file should include netmask_address definition


Story: Fail to add a node with mandatory commandline option error

  Scenario: node add fails if node name is not given
    Given lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add a node with no name
    Then the error message should be: '[error] Node name not defined.'

  Scenario: node add fails if installer name is not given
    Given lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add a node with no installer name
    Then the error message should be: '[error] Installer name not defined.'

  Scenario: node add fails if installer IP address is not given
    Given lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add 'TEST_NODE' node with no IP address
    Then the error message should be: '[error] IP address for node 'TEST_NODE' not defined.'

  Scenario: node add fails if netmask is not given
    Given lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add 'TEST_NODE' node with no netmask
    Then the error message should be: '[error] Netmask address for node 'TEST_NODE' not defined.'

  Scenario: node add fails if gateway is not given
    Given lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add 'TEST_NODE' node with no gateway
    Then the error message should be: '[error] Gateway address for node 'TEST_NODE' not defined.'

  Scenario: node add fails if MAC address is not given
    Given lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add 'TEST_NODE' node with no MAC address
    Then the error message should be: '[error] MAC address for node 'TEST_NODE' not defined.'


Story: Fail to add a node

  Scenario: node add fails if lucie daemon is down
    Given nodes directory is '/tmp/nodes'
    And lucied is stopped
    And no node is added yet
    And TEST_INSTALLER installer is added
    When I add 'TEST_NODE' node
    Then the error message should be: '[error] Lucie daemon (lucied) is down.'

  Scenario: node add fails if same node already exists
    Given nodes directory is '/tmp/nodes'
    And lucied is started
    And no node is added yet
    And no installer is added
    And TEST_INSTALLER installer is added
    When I add 'TEST_NODE' node
    And I add 'TEST_NODE' node
    Then the error message should be: '[error] Node 'TEST_NODE' already exists.'
